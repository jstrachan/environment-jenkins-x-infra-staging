buildPack: none
pipelineConfig:
  pipelines:
    release:
      pipeline:
        agent:
          image: docker.io/rawlingsj80/builder-go:wip71
        stages:
          - name: release
            steps:
              - name: kube-system
                dir: /workspace/source/namespaces/kube-system
                command: jx
                args: ['step','helm','apply']
                env:
                  - name: KUBERNETES_NAMESPACE
                    value: kube-system
              - name: cert-manager-crds
                dir: /workspace/source/namespaces/cert-manager
                command: kubectl
                args: ['apply','--wait', '--validate=true', '-f','https://raw.githubusercontent.com/jetstack/cert-manager/release-0.6/deploy/manifests/00-crds.yaml']
                env:
                  - name: KUBERNETES_NAMESPACE
                    value: cert-manager
              - name: cert-manager
                dir: /workspace/source/namespaces/cert-manager
                command: jx
                args: ['step','helm','apply']
                env:
                  - name: KUBERNETES_NAMESPACE
                    value: cert-manager
              - name: helm-build
                dir: /workspace/source/env
                command: jx
                args: ['step','helm','apply']
                env:
                  - name: KUBERNETES_NAMESPACE
                    value: jx
    pullRequest:
      pipeline:
        agent:
          image: docker.io/rawlingsj80/builder-go:wip70
        stages:
          - name: release
            steps:
              - name: helm-build
                dir: /workspace/source/env
                command: make
                args: ['build']

